<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoibHdidXJrIiwiYSI6ImNqZ21mbm9pdDFiZXgzM21uaTVrNWpqNW4ifQ.d-nFW-zZRUKXM5E8rdgW3Q';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-v9',
    center: [-90.258403, 38.606557],
    zoom: 5
});

var streamId = '<%= id %>'

map.on('load', function() {
    d3.json('http://localhost:3003/activities/' + streamId + '/stream',
        function(err, data) {
            if (err) throw err;

            var coordinates = data.latlng.data.map(function(item) {
                return [item[1], item[0]]
            })

            var geo = {
                type: 'FeatureCollection',
                features: [{
                    type: 'Feature',
                    geometry: {
                        type: 'LineString',
                        coordinates: coordinates
                    }
                }]
            }

            map.addSource('trace', { type: 'geojson', data: geo });
            map.addLayer({
                'id': 'trace',
                'type': 'line',
                'source': 'trace',
                'paint': {
                    'line-color': 'red',
                    'line-opacity': 0.75,
                    'line-width': 3
                }
            });
            map.jumpTo({ 'center': coordinates[0], 'zoom': 14 });
            map.setPitch(30);
        }
    );
});
</script>

